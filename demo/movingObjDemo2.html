<!DOCTYPE html>
<html lang="ja">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=9">
    <meta charset="UTF-8">
    <script type="text/javascript" src="jquery.min.js"></script>
    <script type="text/javascript" src="jspsych.js"></script>
    <script type="text/javascript" src="pwt.js"></script>
<title>ページのタイトル</title>
<style type="text/css">
body {
  margin: 0;
  padding: 0;
  /* cursor: none; */
}
#mainCanvas {
    position:absolute;
    top: 0px;
    left: 0px;
    z-index: 1;
}
</style>
<script type="text/javascript">


onload = function() {
    document.addEventListener("keyup" , KeyUpFunc);
    document.addEventListener("keydown" , KeyDownFunc);
    document.addEventListener("mousedown" , MouseDownFunc);
    document.addEventListener("mouseup" , MouseUpFunc);
    document.addEventListener("mousemove" , MouseMoveFunc);
    
    runExp();
}

async function runExp() {
    const myCanvas = document.getElementById('mainCanvas');
    if (!myCanvas || !myCanvas.getContext) {
        alert("本ページの閲覧はHTML5対応ブラウザで行ってください");
        return false;
    }

    // canvasの幅と高さ、中心座標
    myCanvas.width = window.innerWidth;
    myCanvas.height = window.innerHeight;

    const centerX = myCanvas.width / 2;
    const centerY = myCanvas.height / 2;
    
    const ctx = myCanvas.getContext('2d');

    const bgColor = "rgb(76, 76, 76)";
    const stimColor = "rgb(255, 255, 255)";

    const dist = 400; // 移動距離
    const radius = 30;
    const startX = centerX - dist / 2;

    ClearWindow(ctx, bgColor);
    ctx.font = "bold 22px 'ＭＳ Ｐゴシック'";
    DrawText(ctx, 'スペースキーを押してください。', centerX, centerY, stimColor);
    const time1 = await keyDownCheck([" "]);

    // 運動刺激
    let tmpDist = 0;
    startTime = GetMsecs();
    console.log(startTime);
    timeArray = [];
    v = 0.15;
    cnt = 0;
    while (tmpDist < dist) {
        elapsedTime = GetMsecs() - startTime;
        tmpDist = v * elapsedTime;

        ClearWindow(ctx, bgColor);
        FillOval(ctx, startX +  tmpDist, centerY, radius, stimColor);
        timeArray[cnt] = elapsedTime;
        cnt++;
        //FillRect(canvas, startX + sign * tmpDist, centerY, radius*2, radius*2, 4, stimColor);
        //console.log(tmpDist)
        await waitMsecs(1);
    }
    console.log(timeArray);
}

</script>
</head>
<body>
    <!--
        <audio id="id0"><source src="a.m4a"><source src="a.ogg"></audio>
        -->
    <!-- <canvas id="mainCanvas" width="500" height="400"></canvas> -->
    <canvas id="mainCanvas"></canvas> 
</body>
</html>